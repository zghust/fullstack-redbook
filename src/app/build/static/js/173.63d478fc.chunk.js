"use strict";(self.webpackChunkredbook01=self.webpackChunkredbook01||[]).push([[173],{7173:(e,t,n)=>{n.r(t),n.d(t,{default:()=>g});var i,o=n(2791),l=n(3267),a=n(9150),s=n(8778),r=n(3835),c=n(5057),d=n(1274),h=n(1773),m=n(1777),p=n(168);const u=n(4210).ZP.div(i||(i=(0,p.Z)(["\n  .add {\n    box-sizing: border-box;\n    width: 100%;\n    height: 100vh;\n    padding: 20px;\n    .top {\n      box-sizing: border-box;\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      font-size: 20px;\n      padding-bottom: 30px;\n      .back {\n        padding: 10px 20px;\n      }\n    }\n  }\n"])));var x=n(9434),v=n(184);function f(e){let{navigate:t}=e;const n=(0,x.v9)((e=>e.home.itemdetail)),[i,p]=(0,o.useState)([]),[f,g]=(0,o.useState)();(0,o.useEffect)((()=>{g(null===n||void 0===n?void 0:n.cover)}),[null===n||void 0===n?void 0:n.cover]);const w={onRemove:e=>{const t=i.indexOf(e),n=i.slice();n.splice(t,1),p(n)},beforeUpload:e=>{if(!e.type.startsWith("image/"))return l.FN.show("\u53ea\u80fd\u4e0a\u4f20\u56fe\u7247\u6587\u4ef6\uff01"),!1;!function(e,t){const n=new FileReader;n.readAsDataURL(e),n.onload=n=>{const i=new Image;i.src=n.target.result,i.onload=()=>{const n=document.createElement("canvas"),o=n.getContext("2d");let l=i.width,a=i.height;l>a?l>800&&(a*=800/l,l=800):a>600&&(l*=600/a,a=600),n.width=l,n.height=a,o.drawImage(i,0,0,l,a),n.toBlob((n=>{const i=new File([n],e.name,{type:e.type,lastModified:Date.now()});t(i)}),e.type)}}}(e,(e=>{((e,t)=>{const n=new FileReader;n.addEventListener("load",(()=>t(n.result))),n.readAsDataURL(e)})(e,(e=>{g(e)})),p([...i,e])}))},fileList:i};return(0,v.jsx)(u,{children:(0,v.jsxs)("div",{className:"add",children:[(0,v.jsxs)("div",{className:"top",children:[(0,v.jsx)("div",{onClick:()=>t(-1),className:"back",children:(0,v.jsx)(s.Z,{fontSize:20})}),(0,v.jsx)(r.Z,{fontSize:20})]}),(0,v.jsx)("div",{children:(0,v.jsxs)(c.Z,{onFinish:async e=>{let{title:o,content:s}=e;try{const e=new FormData;if(e.append("title",o),e.append("content",s),0!==i.length)i.forEach((t=>{e.append("cover",t)}));else try{const t=await fetch(n.cover),i=await t.blob(),o=new File([i],"cover.jpg");e.append("cover",o)}catch(r){console.error("\u4e0b\u8f7d\u5c01\u9762\u6587\u4ef6\u5931\u8d25:",r)}await(0,a.Z)({method:"patch",url:"/moment/my/".concat(n.id),data:e});l.u_.alert({content:"\u7f16\u8f91\u6587\u7ae0\u6210\u529f~",closeOnMaskClick:!0,onConfirm:()=>{t("/home")}})}catch(r){console.error("\u4e0a\u4f20\u5931\u8d25:",r)}},initialValues:{title:null===n||void 0===n?void 0:n.title,content:null===n||void 0===n?void 0:n.content},children:[(0,v.jsx)(c.Z.Item,{name:"cover",children:(0,v.jsx)("div",{children:(0,v.jsx)(d.Z,{listType:"picture-card",showUploadList:!1,...w,children:(0,v.jsx)("img",{className:"head",src:f,style:{width:100,height:100},alt:"cover"})})})}),(0,v.jsx)(c.Z.Item,{name:"title",rules:[{required:!0,message:"\u6587\u7ae0\u6807\u9898\u4e0d\u80fd\u4e3a\u7a7a\uff01"}],children:(0,v.jsx)(l.II,{placeholder:"\u8bf7\u8f93\u5165\u6587\u7ae0\u6807\u9898",style:{width:400}})}),(0,v.jsx)(l.iz,{}),(0,v.jsx)(c.Z.Item,{name:"content",rules:[{required:!0,message:"\u6587\u7ae0\u5185\u5bb9\u4e0d\u80fd\u4e3a\u7a7a\uff01"}],children:(0,v.jsx)(l.Kx,{placeholder:"\u8bf7\u8f93\u5165\u5185\u5bb9",rows:15,showCount:!0,maxLength:3e3})}),(0,v.jsx)(c.Z.Item,{children:(0,v.jsx)(h.Z,{size:"large",children:(0,v.jsx)(m.ZP,{type:"primary",htmlType:"submit",children:"\u63d0\u4ea4\u4fee\u6539\u6587\u7ae0"})})})]})})]})})}const g=(0,o.memo)(f)},3835:(e,t,n)=>{n.d(t,{Z:()=>o});var i=n(2791);const o=function(e){return i.createElement("svg",Object.assign({width:"1em",height:"1em",viewBox:"0 0 49 48",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},e,{style:Object.assign({verticalAlign:"-0.125em"},e.style),className:["antd-mobile-icon",e.className].filter(Boolean).join(" ")}),i.createElement("g",{id:"InformationCircleOutline-InformationCircleOutline",stroke:"none",strokeWidth:1,fill:"none",fillRule:"evenodd"},i.createElement("g",{transform:"translate(1.000000, 0.000000)",id:"InformationCircleOutline-\u7f16\u7ec4"},i.createElement("rect",{id:"InformationCircleOutline-\u77e9\u5f62",fill:"#FFFFFF",opacity:0,x:0,y:0,width:48,height:48}),i.createElement("path",{d:"M24,2 C36.1502645,2 46,11.8497355 46,24 C46,36.1502645 36.1502645,46 24,46 C11.8497355,46 2,36.1502645 2,24 C2,11.8497355 11.8497355,2 24,2 Z M24,5 C13.5065898,5 5,13.5065898 5,24 C5,34.4934102 13.5065898,43 24,43 C34.4934102,43 43,34.4934102 43,24 C43,13.5065898 34.4934102,5 24,5 Z M25.6,20 C25.8209139,20 26,20.1790861 26,20.4 L26,34.6 C26,34.8209139 25.8209139,35 25.6,35 L23.4,35 C23.1790861,35 23,34.8209139 23,34.6 L23,23 L21.4,23 C21.1790861,23 21,22.8209139 21,22.6 L21,20.4 C21,20.1790861 21.1790861,20 21.4,20 L25.6,20 Z M25.6,14 C25.8209139,14 26,14.1790861 26,14.4 L26,16.6 C26,16.8209139 25.8209139,17 25.6,17 L23.4,17 C23.1790861,17 23,16.8209139 23,16.6 L23,14.4 C23,14.1790861 23.1790861,14 23.4,14 L25.6,14 Z",id:"InformationCircleOutline-\u5f62\u72b6\u7ed3\u5408",fill:"currentColor",fillRule:"nonzero"}))))}}}]);
//# sourceMappingURL=173.63d478fc.chunk.js.map