"use strict";(self.webpackChunkredbook01=self.webpackChunkredbook01||[]).push([[36],{3747:(e,n,i)=>{i.d(n,{Z:()=>d});var l=i(9165),t=i(2434);const d=()=>{const e=(0,t.getToken)();if(!e)return null;try{return(0,l.o)(e).id}catch(n){console.error("\u89e3\u7801 token \u65f6\u53d1\u751f\u9519\u8bef:",n)}}},9036:(e,n,i)=>{i.r(n),i.d(n,{default:()=>k});var l=i(2791),t=i(3267),d=i(8778),o=i(6503),s=i(9598),r=i(5807),c=i(1514),a=i(9098),v=i(5287),u=i(3747),x=i(5982),m=i(9434),p=i(1029),h=i(184);const f=e=>{var n,i,d,r,c;let{comment:a,comments:g,level:j=0,id:y,setVisible1:b,focus:w,setfocus:C,del:I,setdel:k,specialCommentId:S,setSpecialCommentId:L}=e;const[Z,E]=(0,l.useState)(""),z=null===(null===a||void 0===a?void 0:a.commentId),N=null===a||void 0===a?void 0:a.id,F=(0,l.useRef)(),R=(0,m.I0)();(0,l.useEffect)((()=>{w&&(F.current.focus(),b(!1))}),[w]),(0,l.useEffect)((()=>{I&&S===a.id&&(R((0,p.fR)({commentId:S})).then((()=>{R((0,p.RP)(y))})),k(!1),L(null))}),[I]);const[U,B]=(0,l.useState)(null===a||void 0===a?void 0:a.favor),[A,O]=(0,l.useState)(!1);return(0,h.jsx)(h.Fragment,{children:N?(0,h.jsxs)("div",{style:{marginLeft:z?0:1===j?"20px":0,lineHeight:"1.9"},children:[(0,h.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",flexShrink:"0"},children:[(0,h.jsxs)("div",{style:{display:"flex",flexShrink:"0"},children:[j>=1?(0,h.jsx)(t.qE,{src:null===a||void 0===a||null===(n=a.commentuser)||void 0===n?void 0:n.avatar,style:{"--border-radius":"50%","--size":"24px"}}):(0,h.jsx)(t.qE,{src:null===a||void 0===a||null===(i=a.commentuser)||void 0===i?void 0:i.avatar,style:{"--border-radius":"50%","--size":"32px"}}),(0,h.jsx)("div",{style:{flex:"1"},children:(0,h.jsxs)("div",{style:{paddingLeft:"10px",paddingRight:"10px"},children:[(0,h.jsxs)("div",{style:{display:"flex"},children:[(null===a||void 0===a||null===(d=a.commentuser)||void 0===d?void 0:d.surname)||(null===a||void 0===a||null===(r=a.commentuser)||void 0===r?void 0:r.name),j>=2&&(0,h.jsxs)("div",{style:{marginLeft:"10px",display:"flex"},children:["\u56de\u590d",(0,h.jsx)("div",{children:(null===g||void 0===g?void 0:g.filter((e=>e.id===(null===a||void 0===a?void 0:a.commentId)))[0].commentuser.surname)||(null===g||void 0===g?void 0:g.filter((e=>e.id===(null===a||void 0===a?void 0:a.commentId)))[0].commentuser.name)}),":"]})]}),(0,h.jsxs)("div",{style:{width:260},onClick:()=>{const e=(0,u.Z)();e&&!(0,x.Z)()?(a.commentuser.id!==e?F.current.focus():b(!0),L(a.id)):t.FN.show("\u5148\u767b\u9646\u540e\u5bf9\u8bc4\u8bba\u56de\u590d~")},children:[null===a||void 0===a?void 0:a.content,(0,h.jsx)("span",{style:{color:"gray"},children:(0,h.jsxs)(t.T,{children:[(0,h.jsx)("span",{children:(0,v.Z)(null===a||void 0===a?void 0:a.createAt)}),(0,h.jsx)("span",{children:"\u56de\u590d"}),(0,h.jsx)("input",{ref:F,type:"text",value:Z,onChange:e=>E(e.target.value),onBlur:()=>{Z?R((0,p.Hi)({content:Z,momentId:y,commentId:a.id})).then((()=>{R((0,p.RP)(y))})).then((()=>{E(""),C(!1)})):C(!1)},style:{position:"absolute",left:"-9999px",opacity:"0"}})]})})]})]})})]}),(0,h.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,h.jsx)("div",{onClick:()=>{A?(B(U-1),O(!1),R((0,p.Xm)({commentId:a.id,favor:U-1}))):(B(U+1),O(!0),R((0,p.Xm)({commentId:a.id,favor:U+1})))},children:A?(0,h.jsx)(s.Z,{fontSize:18,color:"red"}):(0,h.jsx)(o.Z,{fontSize:18})}),(0,h.jsxs)("div",{children:[" ",U]})]})]}),null===g||void 0===g||null===(c=g.filter((e=>(null===e||void 0===e?void 0:e.commentId)===(null===a||void 0===a?void 0:a.id))))||void 0===c?void 0:c.map((e=>(0,h.jsx)("div",{children:(0,h.jsx)(f,{comment:e,comments:g,level:j+1,id:y,setVisible1:b,focus:w,setfocus:C,del:I,setdel:k,specialCommentId:S,setSpecialCommentId:L},null===e||void 0===e?void 0:e.id)},null===e||void 0===e?void 0:e.id)))]},null===a||void 0===a?void 0:a.id):(0,h.jsx)("div",{style:{marginTop:"30px",color:"gray"},children:"\u8fd9\u91cc\u662f\u4e00\u7247\u8352\u8349\u5730\uff0c\u6765\u8bc4\u8bba\u4e00\u4e0b\u5427~"})})},g=e=>{var n;let{comments:i,avaUrl:d,id:o,isSay:s,setIsSay:r}=e;const c=(0,m.I0)(),[a,v]=(0,l.useState)(""),[u,g]=(0,l.useState)(),[j,y]=(0,l.useState)(!1),[b,w]=(0,l.useState)(!1),[C,I]=(0,l.useState)(!1),k=(0,l.useRef)();if((0,l.useEffect)((()=>{s&&(k.current.focus(),r(!1))}),[s]),!i||!Array.isArray(i))return null;return(0,h.jsxs)("div",{children:[(0,h.jsxs)("div",{children:["\u5171",1===(null===i||void 0===i?void 0:i.length)?null===i[0].id?0:1:null===i||void 0===i?void 0:i.length,"\u6761\u8bc4\u8bba"]}),(0,h.jsx)("div",{children:(0,x.Z)()?(0,h.jsx)("div",{style:{marginTop:"20px",marginBottom:"20px",color:"grey",textAlign:"center"},children:"\u8bf7\u767b\u9646\u540e\u53d1\u8868\u8bc4\u8bba\u5427~"}):(0,h.jsxs)("div",{style:{marginTop:"30px",marginBottom:"30px",display:"flex"},children:[(0,h.jsx)(t.qE,{src:d,style:{"--border-radius":"50%","--size":"32px"}}),(0,h.jsx)("input",{ref:k,placeholder:"\u8bf4\u70b9\u4ec0\u4e48",value:a,onChange:e=>v(e.target.value),onBlur:e=>{(e=>{let{content:n,momentId:i}=e;if(!(0,x.Z)()){if(!n)return;c((0,p.UI)({content:n,momentId:i})).then((()=>{c((0,p.RP)(o)).then((()=>{v("")}))}))}})({content:a,momentId:o})},style:{marginLeft:"10px",paddingLeft:"20px",borderRadius:"16px",border:"none",outline:"none",lineHeight:"32px",height:"32px",flex:1,backgroundColor:"#f8f8f8"}})]})}),null===i||void 0===i||null===(n=i.filter((e=>null===e.commentId)))||void 0===n?void 0:n.map((e=>(0,h.jsx)("div",{children:(0,h.jsx)(f,{comment:e,comments:i,id:o,setVisible1:y,focus:b,setfocus:w,del:C,setdel:I,specialCommentId:u,setSpecialCommentId:g},null===e||void 0===e?void 0:e.id)},null===e||void 0===e?void 0:e.id))),(0,h.jsx)("div",{style:{textAlign:"center",marginTop:"20px",paddingBottom:"50px"},children:"- END -"}),(0,h.jsx)(t.GI,{visible:j,onMaskClick:()=>{y(!1)},onClose:()=>{y(!1)},bodyStyle:{height:"20vh"},children:(0,h.jsxs)(t.aV,{style:{textAlign:"center"},children:[(0,h.jsx)(t.aV.Item,{onClick:()=>{I(!0),y(!1)},arrow:"",children:"\u5220\u9664"}),(0,h.jsx)(t.aV.Item,{onClick:()=>{w(!0),y(!1)},arrow:"",children:"\u56de\u590d"})]})})]})};var j,y=i(168);const b=i(4210).ZP.div(j||(j=(0,y.Z)(["\n  .detail {\n    box-sizing: border-box;\n    width: 100%;\n    height: 100vh;\n\n    .top {\n      box-sizing: border-box;\n      display: flex;\n      width: 100%;\n      justify-content: space-between;\n      align-items: center;\n      position: fixed;\n      font-size: 22px;\n      background-color: white;\n      padding: 15px 20px;\n      .topleft {\n        display: flex;\n        align-items: center;\n        width: 210px;\n      }\n      .topright {\n        border: 1px solid red;\n        border-radius: 15px;\n        padding: 6px 20px;\n        width: 45px;\n        height: 18px;\n        color: red;\n        font-size: 14px;\n        line-height: 18px;\n        text-align: center;\n      }\n      .topright1 {\n        border: 1px solid red;\n        border-radius: 15px;\n        padding: 6px 20px;\n        height: 18px;\n        width: 45px;\n        color: white;\n        background-color: red;\n        font-size: 14px;\n        line-height: 18px;\n        text-align: center;\n      }\n    }\n    .center {\n      overflow-y: auto;\n      overflow-x: hidden;\n      height: 780px;\n    }\n    .center::-webkit-scrollbar {\n      display: none;\n    }\n    .end {\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      position: fixed;\n      padding: 0 20px;\n      bottom: 0;\n      left: 0;\n      right: 0;\n      height: 50px;\n      background-color: white;\n      border-top: 1px solid #f0f0f0;\n      .endfont {\n        font-size: 18px;\n        line-height: 32px;\n      }\n    }\n  }\n"])));var w=i(7689),C=i(6696);const I=e=>{var n,i,f,j,y,I,k,S,L;let{id:Z,onClose:E,show:z}=e;const N=(0,m.I0)();(0,l.useEffect)((()=>{N((0,p.RP)(Z))}),[Z,N]),(0,l.useEffect)((()=>{(0,u.Z)()&&!(0,x.Z)()&&N((0,C.u4)())}),[N]);const F=(0,w.s0)(),R=(0,m.v9)((e=>e.home.itemdetail)),U=((0,m.v9)((e=>e.user.userdata.data))||[])[0],B=null===(n=R.content)||void 0===n?void 0:n.split("\n").map(((e,n)=>(0,h.jsx)("p",{style:{textIndent:"2em"},children:e},n))),A=(0,u.Z)(),[O,T]=(0,l.useState)();(0,l.useEffect)((()=>{T(null===R||void 0===R?void 0:R.favorCounts)}),[null===R||void 0===R?void 0:R.favorCounts]);const V=(0,x.Z)(),[H,P]=(0,l.useState)(!0);(0,l.useEffect)((()=>{var e;P(!(null!==R&&void 0!==R&&null!==(e=R.favorUserIds)&&void 0!==e&&e.includes(A)))}),[null===R||void 0===R?void 0:R.favorUserIds,A]);const[q,X]=(0,l.useState)(!1);(0,l.useEffect)((()=>{var e;X(null===R||void 0===R||null===(e=R.followUsers)||void 0===e?void 0:e.includes(A))}),[null===R||void 0===R?void 0:R.followUsers,A]);const[D,M]=(0,l.useState)(!1),[W,G]=(0,l.useState)();(0,l.useEffect)((()=>{var e;null!==(null===R||void 0===R?void 0:R.collectUsers)?G(null===R||void 0===R||null===(e=R.collectUsers)||void 0===e?void 0:e.length):G(0)}),[null===R||void 0===R||null===(i=R.collectUsers)||void 0===i?void 0:i.length,null===R||void 0===R?void 0:R.collectUsers]),(0,l.useEffect)((()=>{var e;M(null===R||void 0===R||null===(e=R.collectUsers)||void 0===e?void 0:e.includes(A))}),[null===R||void 0===R?void 0:R.collectUsers,A]);const[Q,_]=(0,l.useState)(!1),J=()=>{_(!Q)};return(0,h.jsx)(b,{children:(0,h.jsxs)("div",{className:"detail",children:[z&&(0,h.jsxs)(h.Fragment,{children:[(0,h.jsxs)("div",{className:"top",children:[(0,h.jsxs)("div",{className:"topleft",children:[(0,h.jsx)("div",{onClick:()=>E(),children:(0,h.jsx)(d.Z,{style:{marginRight:"20px"},fontSize:24})}),(0,h.jsx)(t.qE,{src:null===(f=R.user)||void 0===f?void 0:f.avatar,fit:"contain",style:{"--border-radius":"50%","--size":"32px"}}),(0,h.jsx)("div",{style:{marginLeft:"10px",fontSize:"16px"},children:(null===R||void 0===R||null===(j=R.user)||void 0===j?void 0:j.surname)||(null===R||void 0===R||null===(y=R.user)||void 0===y?void 0:y.name)})]}),(0,h.jsx)("div",{className:q?"topright1":"topright",onClick:()=>{A&&!V?(N((0,p.Xb)({id:A,beFollowedUser:R.user.id})),X((e=>!e))):t.FN.show({content:"\u5148\u767b\u9646\uff0c\u540e\u5173\u6ce8~"})},children:q?"\u5df2\u5173\u6ce8":"\u5173\u6ce8"})]}),(0,h.jsx)("div",{style:{height:"60px"}})]}),(0,h.jsxs)("div",{className:"center",children:[z&&(0,h.jsx)("div",{className:"center-cover",children:(0,h.jsx)(t.Ee,{src:R.cover})}),(0,h.jsxs)("div",{children:[(0,h.jsx)("div",{style:{marginBottom:"10px",fontWeight:600,padding:"10px",paddingBottom:0,fontSize:"18px"},children:R.title}),(0,h.jsx)("div",{style:{margin:"0 auto",lineHeight:"1.6",fontSize:"16px"},children:B}),(0,h.jsx)("div",{style:{marginLeft:"20px"},children:null===(I=R.labels)||void 0===I?void 0:I.map((e=>null===e||void 0===e?void 0:e.name))}),(0,h.jsxs)("div",{style:{marginLeft:"20px",marginRight:"20px",display:"flex",justifyContent:"space-between"},children:[(0,h.jsxs)("div",{children:[" ",(0,v.Z)(R.updateAt)]}),(0,h.jsx)("div",{children:A===(null===R||void 0===R||null===(k=R.user)||void 0===k?void 0:k.id)&&(0,h.jsx)("div",{onClick:()=>F("/edit"),children:"\u7f16\u8f91\u6587\u7ae0"})})]}),(0,h.jsx)(t.iz,{}),(0,h.jsx)("div",{style:{marginLeft:"20px",marginRight:"20px"},children:(0,h.jsx)(g,{comments:R.comments,avaUrl:null===U||void 0===U?void 0:U.ava_url,id:Z,isSay:Q,setIsSay:_})})]})]}),(0,x.Z)()?null:z?(0,h.jsxs)("div",{className:"end",children:[(0,h.jsx)("input",{placeholder:"\u8bf4\u70b9\u4ec0\u4e48",onClick:J,style:{paddingLeft:"20px",borderRadius:"16px",border:"none",outline:"none",lineHeight:"32px",height:"32px",width:"100px",backgroundColor:"#f8f8f8"}}),(0,h.jsxs)("div",{style:{fontSize:"28px",display:"flex",alignItems:"center"},children:[(0,h.jsx)("div",{onClick:()=>{A&&!V?(N((0,p.Qw)(Z)),H?(T(O+1),P(!H)):(T(O-1),P(!H))):t.FN.show({content:"\u5148\u767b\u9646\uff0c\u540e\u70b9\u8d5e~"})},children:H?(0,h.jsx)(o.Z,{}):(0,h.jsx)(s.Z,{color:"red"})}),(0,h.jsx)("span",{className:"endfont",children:O}),(0,h.jsx)("div",{onClick:()=>{A&&!V?(N((0,p.LC)({id:A,momentId:Z})),D?(G(W-1),M(!D)):(G(W+1),M(!D))):t.FN.show({content:"\u5148\u767b\u9646\uff0c\u540e\u6536\u85cf~"})},children:D?(0,h.jsx)(c.Z,{style:{paddingLeft:"10px",color:" #FFCC00"}}):(0,h.jsx)(r.Z,{style:{paddingLeft:"10px"}})}),(0,h.jsx)("span",{className:"endfont",children:W}),(0,h.jsx)(a.Z,{style:{paddingLeft:"10px"},onClick:J}),(0,h.jsx)("span",{className:"endfont",children:1===(null===R||void 0===R||null===(S=R.comments)||void 0===S?void 0:S.length)?null===(null===R||void 0===R?void 0:R.comments[0].id)?0:1:null===R||void 0===R||null===(L=R.comments)||void 0===L?void 0:L.length})]})]}):null]})})},k=(0,l.memo)(I)},5287:(e,n,i)=>{i.d(n,{Z:()=>s});var l=i(7892),t=i.n(l),d=(i(7490),i(130)),o=i.n(d);t().locale("zh-cn"),t().extend(o());const s=e=>t()(e).fromNow()},8778:(e,n,i)=>{i.d(n,{Z:()=>t});var l=i(2791);const t=function(e){return l.createElement("svg",Object.assign({width:"1em",height:"1em",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},e,{style:Object.assign({verticalAlign:"-0.125em"},e.style),className:["antd-mobile-icon",e.className].filter(Boolean).join(" ")}),l.createElement("g",{id:"LeftOutline-LeftOutline",stroke:"none",strokeWidth:1,fill:"none",fillRule:"evenodd"},l.createElement("g",{id:"LeftOutline-\u7f16\u7ec4"},l.createElement("rect",{id:"LeftOutline-\u77e9\u5f62",fill:"#FFFFFF",opacity:0,x:0,y:0,width:48,height:48}),l.createElement("path",{d:"M31.7053818,5.11219264 L13.5234393,22.6612572 L13.5234393,22.6612572 C12.969699,23.2125856 12.9371261,24.0863155 13.4257204,24.6755735 L13.5234393,24.7825775 L31.7045714,42.8834676 C31.7795345,42.9580998 31.8810078,43 31.9867879,43 L35.1135102,43 C35.3344241,43 35.5135102,42.8209139 35.5135102,42.6 C35.5135102,42.4936115 35.4711279,42.391606 35.3957362,42.316542 L16.7799842,23.7816937 L16.7799842,23.7816937 L35.3764658,5.6866816 C35.5347957,5.53262122 35.5382568,5.27937888 35.3841964,5.121049 C35.3088921,5.04365775 35.205497,5 35.0975148,5 L31.9831711,5 C31.8795372,5 31.7799483,5.04022164 31.7053818,5.11219264 Z",id:"LeftOutline-\u8def\u5f84",fill:"currentColor",fillRule:"nonzero"}))))}}}]);
//# sourceMappingURL=36.76d1b0fb.chunk.js.map